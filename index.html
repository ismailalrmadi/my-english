<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals & Soft Teal -->
    <!-- Application Structure Plan: The SPA is designed with a top-down information architecture. Key navigation is a horizontal scrollable bar of months, allowing quick access to any part of the year. Below this, a prominent "Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø­Ø¯Ø¯" (Selected Lesson) area provides a focused view of a single day's content. The main body consists of a grid of "cards," each representing a day within the selected month. This structure was chosen for usability because it prevents overwhelming the user with 365 items at once. It provides a clear monthly overview (the cards) and a detailed, uncluttered daily focus (the main display), which is ideal for a daily learning plan. -->
    <!-- Visualization & Content Choices: The source report is entirely textual and structured chronologically. Goal: Organize & Inform. Presentation Method: The primary method is dynamically generated HTML content blocks (cards and a main display area). This is superior to a static table for interactivity and mobile usability. Interaction: Users filter the entire dataset by clicking a month, then select a specific day's card to view its details. This interaction directly supports the designed structure. Justification: This approach makes navigating a year-long plan intuitive and fast. Since there is no quantitative data suitable for charts, Chart.js/Plotly were not used. All content is presented as structured, interactive text. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #FDFCFB;
        }
        .smooth-scroll {
            scroll-behavior: smooth;
        }
        .month-nav::-webkit-scrollbar {
            display: none;
        }
        .month-nav {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #14B8A6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        .gemini-btn:disabled, .listen-sentence-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-5xl font-bold text-teal-700">Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</h1>
            <p class="mt-2 text-lg text-stone-600">Ù…Ù†Ù‡Ø¬ÙƒÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ âœ¨</p>
        </header>

        <main>
            <!-- Navigation by Month -->
            <nav id="month-navigation" class="month-nav sticky top-0 bg-stone-50/80 backdrop-blur-sm py-4 z-10 mb-8 overflow-x-auto whitespace-nowrap">
                <div id="month-buttons-container" class="flex items-center space-x-4 space-x-reverse px-2">
                    <!-- Month buttons will be dynamically inserted here -->
                </div>
            </nav>

            <!-- Selected Lesson Display -->
            <section id="selected-lesson-section" class="mb-10 p-6 bg-white rounded-2xl shadow-lg border border-stone-200 smooth-scroll">
                 <div class="text-center pb-4 border-b border-stone-200 mb-4">
                     <h2 id="selected-lesson-title" class="text-2xl font-bold text-teal-800">Ø§Ø®ØªØ± ÙŠÙˆÙ…Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ Ù„ØªØ¨Ø¯Ø£</h2>
                     <p id="selected-lesson-subtitle" class="text-stone-500"></p>
                 </div>
                 <div id="selected-lesson-content" class="text-center text-lg">
                    <p class="text-stone-500">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§.</p>
                 </div>
                 <!-- Gemini Features Section -->
                 <div id="gemini-features" class="mt-6 pt-6 border-t border-stone-200 hidden">
                    <h3 class="text-xl font-bold text-center mb-4 text-teal-700">Ø·ÙˆØ± Ù…Ù…Ø§Ø±Ø³ØªÙƒ Ù…Ø¹ Gemini âœ¨</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                        <button id="expand-dialogue-btn" class="gemini-btn bg-teal-600 text-white font-bold py-3 px-4 rounded-full hover:bg-teal-700 transition-colors duration-300 flex items-center justify-center gap-2 shadow-md">
                            <span>ÙˆØ³Ù‘Ø¹ Ø§Ù„Ø­ÙˆØ§Ø±</span>
                        </button>
                        <button id="new-situation-btn" class="gemini-btn bg-teal-100 text-teal-800 font-bold py-3 px-4 rounded-full hover:bg-teal-200 transition-colors duration-300 flex items-center justify-center gap-2">
                            <span>Ø§Ù‚ØªØ±Ø­ Ù…ÙˆÙ‚ÙØ§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹</span>
                        </button>
                         <button id="visualize-situation-btn" class="gemini-btn bg-indigo-500 text-white font-bold py-3 px-4 rounded-full hover:bg-indigo-600 transition-colors duration-300 flex items-center justify-center gap-2 shadow-md">
                            <span>ØªØ®ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ù ğŸ–¼ï¸</span>
                        </button>
                        <button id="explain-rule-btn" class="gemini-btn bg-amber-500 text-white font-bold py-3 px-4 rounded-full hover:bg-amber-600 transition-colors duration-300 flex items-center justify-center gap-2">
                            <span>Ø´Ø±Ø­ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© ğŸ§‘â€ğŸ«</span>
                        </button>
                         <button id="role-play-btn" class="gemini-btn bg-rose-500 text-white font-bold py-3 px-4 rounded-full hover:bg-rose-600 transition-colors duration-300 flex items-center justify-center gap-2 shadow-md">
                            <span>ØªØ¯Ø±Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙˆØ§Ø± ğŸ­</span>
                        </button>
                         <button id="quiz-btn" class="gemini-btn bg-lime-500 text-white font-bold py-3 px-4 rounded-full hover:bg-lime-600 transition-colors duration-300 flex items-center justify-center gap-2 shadow-md">
                            <span>Ø§Ø®ØªØ¨Ø± Ù…ÙØ±Ø¯Ø§ØªÙƒ ğŸ§ </span>
                        </button>
                        <button id="story-btn" class="gemini-btn bg-cyan-500 text-white font-bold py-3 px-4 rounded-full hover:bg-cyan-600 transition-colors duration-300 flex items-center justify-center gap-2 shadow-md">
                            <span>Ø§ÙƒØªØ¨ Ù‚ØµØ© Ù‚ØµÙŠØ±Ø© ğŸ“–</span>
                        </button>
                        <button id="culture-btn" class="gemini-btn bg-purple-500 text-white font-bold py-3 px-4 rounded-full hover:bg-purple-600 transition-colors duration-300 flex items-center justify-center gap-2 shadow-md">
                            <span>Ù…Ø¹Ù„ÙˆÙ…Ø© Ø«Ù‚Ø§ÙÙŠØ© ğŸ’¡</span>
                        </button>
                    </div>

                    <div id="sentence-correction-feature" class="mt-6 pt-4 border-t border-dashed">
                        <h4 class="font-semibold text-lg text-center text-stone-700 mb-3">ØªØ¯Ø±Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØªØ§Ø¨Ø©</h4>
                        <div class="flex flex-col gap-3">
                            <textarea id="sentence-input" class="w-full p-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-amber-400 transition" placeholder="Ø§ÙƒØªØ¨ Ø¬Ù…Ù„Ø© Ù‡Ù†Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø§Øª Ø§Ù„ÙŠÙˆÙ…..."></textarea>
                            <button id="correct-sentence-btn" class="gemini-btn bg-orange-500 text-white font-bold py-3 px-6 rounded-full hover:bg-orange-600 transition-colors duration-300 flex items-center justify-center gap-2 self-center">
                                <span>ØµØ­Ø­ Ø¬Ù…Ù„ØªÙŠ âœï¸</span>
                            </button>
                        </div>
                    </div>

                    <div id="gemini-response-container" class="mt-6 p-4 bg-teal-50/50 rounded-lg min-h-[120px] text-center flex items-center justify-center">
                        <p class="text-stone-500">Ø³ØªØ¸Ù‡Ø± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù‡Ù†Ø§.</p>
                    </div>
                </div>
            </section>
            
            <!-- Daily Lesson Cards -->
            <section>
                <h2 id="current-month-title" class="text-2xl font-bold mb-6 text-center md:text-right"></h2>
                <div id="daily-cards-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                    <!-- Daily lesson cards will be dynamically inserted here -->
                </div>
            </section>

        </main>

        <footer class="text-center mt-12 py-4 border-t border-stone-200">
            <p class="text-stone-500">ØªÙ… Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„ØªØ·ÙˆÙŠØ± Ù„ØªØ³Ù‡ÙŠÙ„ Ø±Ø­Ù„Ø© ØªØ¹Ù„Ù… Ø§Ù„Ù„ØºØ© Ù„Ø£Ø³Ø±ØªÙƒÙ….</p>
        </footer>
    </div>
    <audio id="audio-player" class="hidden"></audio>

    <script>
        const yearlyPlanData = [
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ", "day": "1", "situation": "Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸", "english": "A: Good morning! Time to wake up. B: Good morning. Did you sleep well?", "arabic": "Ø£: ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±! Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸. Ø¨: ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±. Ù‡Ù„ Ù†Ù…Øª Ø¬ÙŠØ¯Ù‹Ø§ØŸ", "words": "morning, wake up, sleep" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ", "day": "2", "situation": "Ø§Ù„Ø¥ÙØ·Ø§Ø±", "english": "A: What would you like for breakfast? B: I'd like some eggs, please.", "arabic": "Ø£: Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø¹Ù„Ù‰ ÙˆØ¬Ø¨Ø© Ø§Ù„Ø¥ÙØ·Ø§Ø±ØŸ Ø¨: Ø£Ø±ÙŠØ¯ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ¶ØŒ Ù…Ù† ÙØ¶Ù„Ùƒ.", "words": "breakfast, like, eggs" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ", "day": "3", "situation": "Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„", "english": "A: Have a nice day! Goodbye! B: You too! See you later.", "arabic": "Ø£: Ø£ØªÙ…Ù†Ù‰ Ù„Ùƒ ÙŠÙˆÙ…Ù‹Ø§ Ù„Ø·ÙŠÙÙ‹Ø§! Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©! Ø¨: ÙˆØ£Ù†Øª Ø£ÙŠØ¶Ù‹Ø§! Ø£Ø±Ø§Ùƒ Ù„Ø§Ø­Ù‚Ù‹Ø§.", "words": "day, goodbye, later" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ", "day": "4", "situation": "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†Ø²Ù„", "english": "A: Welcome home! How was your day? B: It was good, thank you. A bit busy.", "arabic": "Ø£: Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ! ÙƒÙŠÙ ÙƒØ§Ù† ÙŠÙˆÙ…ÙƒØŸ Ø¨: ÙƒØ§Ù† Ø¬ÙŠØ¯Ù‹Ø§ØŒ Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ. Ø­Ø§ÙÙ„Ø§Ù‹ Ø¨Ø¹Ø¶ Ø§Ù„Ø´ÙŠØ¡.", "words": "home, day, busy" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ", "day": "5", "situation": "Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª", "english": "A: Do you have a lot of homework? B: Yes, I need a little help with Math.", "arabic": "Ø£: Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§ØªØŸ Ø¨: Ù†Ø¹Ù…ØŒ Ø£Ø­ØªØ§Ø¬ Ø§Ù„Ù‚Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª.", "words": "homework, help, math" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ", "day": "6", "situation": "Ø§Ù„Ø¹Ø´Ø§Ø¡", "english": "A: Dinner is ready. Please come to the table. B: It smells delicious! What did you make?", "arabic": "Ø£: Ø§Ù„Ø¹Ø´Ø§Ø¡ Ø¬Ø§Ù‡Ø². Ù…Ù† ÙØ¶Ù„ÙƒÙ… ØªØ¹Ø§Ù„ÙˆØ§ Ø¥Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©. Ø¨: Ø±Ø§Ø¦Ø­ØªÙ‡ Ø´Ù‡ÙŠØ©! Ù…Ø§Ø°Ø§ Ø£Ø¹Ø¯Ø¯ØªØŸ", "words": "dinner, ready, delicious" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ", "day": "7", "situation": "Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ù†ÙˆÙ…", "english": "A: It's time to brush your teeth and go to bed. B: Okay. Can you read me a story?", "arabic": "Ø£: Ø­Ø§Ù† ÙˆÙ‚Øª ØªÙ†Ø¸ÙŠÙ Ø£Ø³Ù†Ø§Ù†Ùƒ ÙˆØ§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø±ÙŠØ±. Ø¨: Ø­Ø³Ù†Ù‹Ø§. Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªÙ‚Ø±Ø£ Ù„ÙŠ Ù‚ØµØ©ØŸ", "words": "brush teeth, bed, story" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ", "day": "28", "situation": "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±", "english": "A: We learned so many new phrases this month! B: Yes! Our English is getting better.", "arabic": "Ø£: Ù„Ù‚Ø¯ ØªØ¹Ù„Ù…Ù†Ø§ Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±! Ø¨: Ù†Ø¹Ù…! Ù„ØºØªÙ†Ø§ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ØªØªØ­Ø³Ù†.", "words": "learned, phrases, better" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø¨ÙŠØª ÙˆØ§Ù„Ù…Ù‡Ø§Ù…", "day": "29", "situation": "ØªØ±ØªÙŠØ¨ Ø§Ù„ØºØ±ÙØ©", "english": "A: Let's tidy up your room. It's a bit messy. B: Okay. Where should I put my toys?", "arabic": "Ø£: Ù„Ù†Ø±ØªØ¨ ØºØ±ÙØªÙƒ. Ø¥Ù†Ù‡Ø§ ÙÙˆØ¶ÙˆÙŠØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹. Ø¨: Ø­Ø³Ù†Ù‹Ø§. Ø£ÙŠÙ† ÙŠØ¬Ø¨ Ø£Ù† Ø£Ø¶Ø¹ Ø£Ù„Ø¹Ø§Ø¨ÙŠØŸ", "words": "tidy up, room, toys" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø¨ÙŠØª ÙˆØ§Ù„Ù…Ù‡Ø§Ù…", "day": "55", "situation": "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±", "english": "A: Our house looks so clean and tidy. Great teamwork! B: Yes! We are a great team.", "arabic": "Ø£: Ù…Ù†Ø²Ù„Ù†Ø§ ÙŠØ¨Ø¯Ùˆ Ù†Ø¸ÙŠÙÙ‹Ø§ ÙˆÙ…Ø±ØªØ¨Ù‹Ø§. Ø¹Ù…Ù„ Ø¬Ù…Ø§Ø¹ÙŠ Ø±Ø§Ø¦Ø¹! Ø¨: Ù†Ø¹Ù…! Ù†Ø­Ù† ÙØ±ÙŠÙ‚ Ø±Ø§Ø¦Ø¹.", "words": "house, teamwork, great" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© ÙˆØ§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡", "day": "56", "situation": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¶ÙŠÙˆÙ", "english": "A: Welcome to our home! Please, come in. B: Thank you for having us. Your home is lovely.", "arabic": "Ø£: Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†Ø²Ù„Ù†Ø§! ØªÙØ¶Ù„ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„. Ø¨: Ø´ÙƒØ±Ù‹Ø§ Ù„Ø§Ø³ØªØ¶Ø§ÙØªÙ†Ø§. Ù…Ù†Ø²Ù„Ùƒ Ø¬Ù…ÙŠÙ„.", "words": "welcome, home, guests" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© ÙˆØ§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡", "day": "70", "situation": "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±", "english": "A: It's always nice to spend time with family. B: Yes, family is very important.", "arabic": "Ø£: Ù…Ù† Ø§Ù„Ù„Ø·ÙŠÙ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù‚Ø¶Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª Ù…Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©. Ø¨: Ù†Ø¹Ù…ØŒ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ù…Ù‡Ù…Ø© Ø¬Ø¯Ù‹Ø§.", "words": "spend time, family, important" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„ØªØ³ÙˆÙ‚ ÙˆØ§Ù„Ù…Ø·Ø§Ø¹Ù…", "day": "71", "situation": "ÙÙŠ Ø§Ù„Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª", "english": "A: We need to buy some groceries. Do we have the list? B: Yes, it's right here. First, we need milk.", "arabic": "Ø£: Ù†Ø­ØªØ§Ø¬ Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨Ù‚Ø§Ù„Ø©. Ù‡Ù„ Ù„Ø¯ÙŠÙ†Ø§ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŸ Ø¨: Ù†Ø¹Ù…ØŒ Ù‡ÙŠ Ù‡Ù†Ø§. Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù†Ø­ØªØ§Ø¬ Ø­Ù„ÙŠØ¨Ù‹Ø§.", "words": "groceries, list, milk" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„ØªØ³ÙˆÙ‚ ÙˆØ§Ù„Ù…Ø·Ø§Ø¹Ù…", "day": "84", "situation": "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±", "english": "A: We went to many places this month. B: Yes, shopping in English is fun.", "arabic": "Ø£: Ù„Ù‚Ø¯ Ø°Ù‡Ø¨Ù†Ø§ Ø¥Ù„Ù‰ Ø£Ù…Ø§ÙƒÙ† ÙƒØ«ÙŠØ±Ø© Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±. Ø¨: Ù†Ø¹Ù…ØŒ Ø§Ù„ØªØ³ÙˆÙ‚ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù…Ù…ØªØ¹.", "words": "places, shopping, fun" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø®Ø§Ù…Ø³: Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ÙˆØ§Ù„ÙˆØµÙ", "day": "85", "situation": "Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©", "english": "A: I'm so happy today! I got a good grade. B: That's wonderful news! I'm proud of you.", "arabic": "Ø£: Ø£Ù†Ø§ Ø³Ø¹ÙŠØ¯ Ø¬Ø¯Ù‹Ø§ Ø§Ù„ÙŠÙˆÙ…! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø© Ø¬ÙŠØ¯Ø©. Ø¨: Ù‡Ø°Ù‡ Ø£Ø®Ø¨Ø§Ø± Ø±Ø§Ø¦Ø¹Ø©! Ø£Ù†Ø§ ÙØ®ÙˆØ± Ø¨Ùƒ.", "words": "happy, good grade, proud" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø®Ø§Ù…Ø³: Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ÙˆØ§Ù„ÙˆØµÙ", "day": "98", "situation": "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±", "english": "A: How are you feeling right now? B: I'm feeling great and happy!", "arabic": "Ø£: ÙƒÙŠÙ ØªØ´Ø¹Ø± Ø§Ù„Ø¢Ù†ØŸ Ø¨: Ø£Ø´Ø¹Ø± Ø£Ù†Ù†ÙŠ Ø¨Ø­Ø§Ù„ Ø±Ø§Ø¦Ø¹Ø© ÙˆØ³Ø¹ÙŠØ¯!", "words": "feeling, great, happy" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¯Ø³: Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ù†Ø²Ù„", "day": "99", "situation": "ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©", "english": "A: Let's go to the park and play on the swings. B: Yay! Can we go on the slide too?", "arabic": "Ø£: Ù‡ÙŠØ§ Ù†Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø© ÙˆÙ†Ù„Ø¹Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø§Ø¬ÙŠØ­. Ø¨: ÙŠØ§ÙŠ! Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø²Ø­Ù„ÙŠÙ‚Ø© Ø£ÙŠØ¶Ù‹Ø§ØŸ", "words": "park, swings, slide" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¯Ø³: Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ù†Ø²Ù„", "day": "112", "situation": "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±", "english": "A: What was your favorite activity this month? B: I loved building the sandcastle at the beach.", "arabic": "Ø£: Ù…Ø§ Ù‡Ùˆ Ù†Ø´Ø§Ø·Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±ØŸ Ø¨: Ø£Ø­Ø¨Ø¨Øª Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ù„Ø¹Ø© Ø§Ù„Ø±Ù…Ù„ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø·Ø¦.", "words": "favorite, activity, beach" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¨Ø¹: Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆØ§Ù„Ø¹Ù…Ù„", "day": "113", "situation": "ÙÙŠ Ø§Ù„ÙØµÙ„", "english": "A: Please open your books to page ten. B: Yes, teacher.", "arabic": "Ø£: Ù…Ù† ÙØ¶Ù„ÙƒÙ… Ø§ÙØªØ­ÙˆØ§ ÙƒØªØ¨ÙƒÙ… Ø¹Ù„Ù‰ ØµÙØ­Ø© Ø¹Ø´Ø±Ø©. Ø¨: Ù†Ø¹Ù… ÙŠØ§ Ù…Ø¹Ù„Ù….", "words": "open, books, page" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¨Ø¹: Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆØ§Ù„Ø¹Ù…Ù„", "day": "126", "situation": "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±", "english": "A: School and work are important parts of our lives. B: Yes, we learn and grow every day.", "arabic": "Ø£: Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆØ§Ù„Ø¹Ù…Ù„ Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù‡Ù…Ø© Ù…Ù† Ø­ÙŠØ§ØªÙ†Ø§. Ø¨: Ù†Ø¹Ù…ØŒ Ù†Ø­Ù† Ù†ØªØ¹Ù„Ù… ÙˆÙ†Ù†Ù…Ùˆ ÙƒÙ„ ÙŠÙˆÙ….", "words": "important, learn, grow" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù…Ù†: Ø§Ù„Ù‡ÙˆØ§ÙŠØ§Øª ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§", "day": "213", "situation": "Ø§Ù„Ø±Ø³Ù…", "english": "A: What are you drawing? B: I'm drawing a picture of our family.", "arabic": "Ø£: Ù…Ø§Ø°Ø§ ØªØ±Ø³Ù…ØŸ Ø¨: Ø£Ù†Ø§ Ø£Ø±Ø³Ù… ØµÙˆØ±Ø© Ù„Ø¹Ø§Ø¦Ù„ØªÙ†Ø§.", "words": "drawing, picture, family" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù…Ù†: Ø§Ù„Ù‡ÙˆØ§ÙŠØ§Øª ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§", "day": "226", "situation": "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±", "english": "A: Hobbies make our lives more interesting. B: I agree! And technology is very useful.", "arabic": "Ø£: Ø§Ù„Ù‡ÙˆØ§ÙŠØ§Øª ØªØ¬Ø¹Ù„ Ø­ÙŠØ§ØªÙ†Ø§ Ø£ÙƒØ«Ø± Ø¥Ø«Ø§Ø±Ø© Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù…. Ø¨: Ø£ÙˆØ§ÙÙ‚! ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ù…ÙÙŠØ¯Ø© Ø¬Ø¯Ù‹Ø§.", "words": "hobbies, interesting, technology" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ø³Ø¹: Ø§Ù„Ù‚ØµØµ ÙˆØ§Ù„Ø°ÙƒØ±ÙŠØ§Øª", "day": "245", "situation": "Ø§Ù„Ø­Ø¯ÙŠØ« Ø¹Ù† Ø§Ù„Ø£Ù…Ø³", "english": "A: What did you do yesterday? B: I went to the library and read a book.", "arabic": "Ø£: Ù…Ø§Ø°Ø§ ÙØ¹Ù„Øª Ø£Ù…Ø³ØŸ Ø¨: Ø°Ù‡Ø¨Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙˆÙ‚Ø±Ø£Øª ÙƒØªØ§Ø¨Ù‹Ø§.", "words": "yesterday, went, read" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ø³Ø¹: Ø§Ù„Ù‚ØµØµ ÙˆØ§Ù„Ø°ÙƒØ±ÙŠØ§Øª", "day": "258", "situation": "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±", "english": "A: It's fun to talk about our memories. B: Yes, we had many good times.", "arabic": "Ø£: Ù…Ù† Ø§Ù„Ù…Ù…ØªØ¹ Ø§Ù„ØªØ­Ø¯Ø« Ø¹Ù† Ø°ÙƒØ±ÙŠØ§ØªÙ†Ø§. Ø¨: Ù†Ø¹Ù…ØŒ Ù„Ù‚Ø¯ Ù‚Ø¶ÙŠÙ†Ø§ Ø£ÙˆÙ‚Ø§ØªÙ‹Ø§ Ø¬ÙŠØ¯Ø© ÙƒØ«ÙŠØ±Ø©.", "words": "memories, had, good times" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¹Ø§Ø´Ø±: Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©", "day": "277", "situation": "Ø®Ø·Ø· Ø§Ù„ØºØ¯", "english": "A: What are we going to do tomorrow? B: We are going to visit Grandma.", "arabic": "Ø£: Ù…Ø§Ø°Ø§ Ø³Ù†ÙØ¹Ù„ ØºØ¯Ù‹Ø§ØŸ Ø¨: Ø³Ù†Ø²ÙˆØ± Ø§Ù„Ø¬Ø¯Ø©.", "words": "going to, tomorrow, visit" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¹Ø§Ø´Ø±: Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©", "day": "290", "situation": "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ù‡Ø±", "english": "A: It's exciting to think about the future. B: Yes, we have a lot to look forward to.", "arabic": "Ø£: Ù…Ù† Ø§Ù„Ù…Ø«ÙŠØ± Ø§Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„. Ø¨: Ù†Ø¹Ù…ØŒ Ù„Ø¯ÙŠÙ†Ø§ Ø§Ù„ÙƒØ«ÙŠØ± Ù„Ù†ØªØ·Ù„Ø¹ Ø¥Ù„ÙŠÙ‡.", "words": "exciting, future, look forward to" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±: Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ¯Ù…Ø¬ Ø§Ù„Ù…ÙˆØ§Ù‚Ù", "day": "305", "situation": "Ø§Ù„Ø¯Ù…Ø¬: ØªØ³ÙˆÙ‚ ÙˆØ¹Ø´Ø§Ø¡", "english": "A: Let's go to the supermarket. We need ingredients for tonight's dinner. B: Good idea. What are you going to make?", "arabic": "Ø£: Ù‡ÙŠØ§ Ù†Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª. Ù†Ø­ØªØ§Ø¬ Ù…ÙƒÙˆÙ†Ø§Øª Ù„Ø¹Ø´Ø§Ø¡ Ø§Ù„Ù„ÙŠÙ„Ø©. Ø¨: ÙÙƒØ±Ø© Ø¬ÙŠØ¯Ø©. Ù…Ø§Ø°Ø§ Ø³ØªØ­Ø¶Ø±ØŸ", "words": "supermarket, ingredients, make" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±: Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", "day": "331", "situation": "Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", "english": "A: This week, let's try to speak only English. B: Okay, it will be a fun challenge.", "arabic": "Ø£: Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŒ Ù„Ù†Ø¬Ø±Ø¨ Ø§Ù„ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø·. Ø¨: Ø­Ø³Ù†Ù‹Ø§ØŒ Ø³ÙŠÙƒÙˆÙ† ØªØ­Ø¯ÙŠÙ‹Ø§ Ù…Ù…ØªØ¹Ù‹Ø§.", "words": "week, speak, challenge" },
            { "month": "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±: Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", "day": "365", "situation": "Ø§Ù„Ø§Ø­ØªÙØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø³Ù†ÙˆÙŠ", "english": "A: We did it! We completed a whole year of learning English together. B: I'm so proud of our family. Our English is so much better now!", "arabic": "Ø£: Ù„Ù‚Ø¯ ÙØ¹Ù„Ù†Ø§Ù‡Ø§! Ø£ÙƒÙ…Ù„Ù†Ø§ Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ù† ØªØ¹Ù„Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù…Ø¹Ù‹Ø§. Ø¨: Ø£Ù†Ø§ ÙØ®ÙˆØ± Ø¬Ø¯Ù‹Ø§ Ø¨Ø¹Ø§Ø¦Ù„ØªÙ†Ø§. Ù„ØºØªÙ†Ø§ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø£ÙØ¶Ù„ Ø¨ÙƒØ«ÙŠØ± Ø§Ù„Ø¢Ù†!", "words": "proud, family, better" }
        ];
        
        const state = {
            selectedMonth: null,
            selectedDay: null,
            isTTSLoading: false,
            isGeminiLoading: false,
        };

        const monthButtonsContainer = document.getElementById('month-buttons-container');
        const dailyCardsContainer = document.getElementById('daily-cards-container');
        const selectedLessonTitle = document.getElementById('selected-lesson-title');
        const selectedLessonSubtitle = document.getElementById('selected-lesson-subtitle');
        const selectedLessonContent = document.getElementById('selected-lesson-content');
        const currentMonthTitle = document.getElementById('current-month-title');
        const selectedLessonSection = document.getElementById('selected-lesson-section');
        const geminiFeatures = document.getElementById('gemini-features');
        const geminiResponseContainer = document.getElementById('gemini-response-container');
        const expandDialogueBtn = document.getElementById('expand-dialogue-btn');
        const newSituationBtn = document.getElementById('new-situation-btn');
        const explainRuleBtn = document.getElementById('explain-rule-btn');
        const visualizeSituationBtn = document.getElementById('visualize-situation-btn');
        const correctSentenceBtn = document.getElementById('correct-sentence-btn');
        const sentenceInput = document.getElementById('sentence-input');
        const audioPlayer = document.getElementById('audio-player');
        const rolePlayBtn = document.getElementById('role-play-btn');
        const quizBtn = document.getElementById('quiz-btn');
        const storyBtn = document.getElementById('story-btn');
        const cultureBtn = document.getElementById('culture-btn');


        function setGeminiLoading(isLoading) {
            state.isGeminiLoading = isLoading;
            document.querySelectorAll('.gemini-btn').forEach(btn => {
                btn.disabled = isLoading;
            });
             document.querySelectorAll('.listen-sentence-btn').forEach(btn => {
                btn.disabled = isLoading;
            });
            if (isLoading) {
                geminiResponseContainer.innerHTML = '<div class="loader mx-auto"></div>';
            }
        }

        async function callGeminiAPI(prompt, retries = 3, delay = 1000) {
            const apiKey = "AIzaSyBSDEdkDwi2ltENGOGYyPUtA-hFjQw7Gnk"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    if (response.status >= 500 && retries > 0) {
                         await new Promise(res => setTimeout(res, delay));
                         return callGeminiAPI(prompt, retries - 1, delay * 2);
                    }
                    throw new Error(`API call failed with status: ${response.status}`);
                }
                const result = await response.json();
                const candidate = result.candidates?.[0];
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    return candidate.content.parts[0].text;
                } else {
                    return "Ù„Ù… ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø¯. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
                }
            } catch (error) {
                 if (retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return callGeminiAPI(prompt, retries - 1, delay * 2);
                }
                return "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.";
            }
        }

        async function callImagenAPI(prompt, retries = 3, delay = 1000) {
            const apiKey = "AIzaSyBSDEdkDwi2ltENGOGYyPUtA-hFjQw7Gnk"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
            const payload = { instances: [{ prompt: prompt }], parameters: { "sampleCount": 1 } };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    if (response.status >= 500 && retries > 0) {
                        await new Promise(res => setTimeout(res, delay));
                        return callImagenAPI(prompt, retries - 1, delay * 2);
                    }
                    throw new Error(`Imagen API call failed with status: ${response.status}`);
                }
                const result = await response.json();
                if (result.predictions && result.predictions[0]?.bytesBase64Encoded) {
                    return `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                } else {
                    return null;
                }
            } catch (error) {
                if (retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return callImagenAPI(prompt, retries - 1, delay * 2);
                }
                return null;
            }
        }
        
        async function callGeminiTTSAPI(textToSpeak, onFinishCallback) {
            const apiKey = "AIzaSyBSDEdkDwi2ltENGOGYyPUtA-hFjQw7Gnk"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: textToSpeak }] }],
                generationConfig: { responseModalities: ["AUDIO"] },
                model: "gemini-2.5-flash-preview-tts"
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`TTS API call failed: ${response.status}`);
                const result = await response.json();
                const audioData = result?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                if (audioData) {
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, 24000); 
                    const audioUrl = URL.createObjectURL(wavBlob);
                    audioPlayer.src = audioUrl;
                    audioPlayer.play();
                    audioPlayer.onended = () => {
                       if (onFinishCallback) onFinishCallback();
                    };
                } else {
                    throw new Error("No audio data in response.");
                }
            } catch (error) {
                 if (onFinishCallback) onFinishCallback();
            }
        }

        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcmData, sampleRate) {
            const numChannels = 1;
            const bitsPerSample = 16;
            const blockAlign = (numChannels * bitsPerSample) / 8;
            const byteRate = sampleRate * blockAlign;
            const dataSize = pcmData.length * (bitsPerSample / 8);
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);

            function writeString(view, offset, string) {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            }

            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + dataSize, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitsPerSample, true);
            writeString(view, 36, 'data');
            view.setUint32(40, dataSize, true);

            for (let i = 0; i < pcmData.length; i++) {
                view.setInt16(44 + i * 2, pcmData[i], true);
            }

            return new Blob([view], { type: 'audio/wav' });
        }

        function renderMonthButtons(months) {
            monthButtonsContainer.innerHTML = '';
            months.forEach(month => {
                const button = document.createElement('button');
                button.textContent = month.split(':')[0].replace('Ø§Ù„Ø´Ù‡Ø± ', '');
                button.dataset.month = month;
                button.className = 'month-btn flex-shrink-0 px-4 py-2 text-lg font-semibold text-stone-600 rounded-full transition-colors duration-300 hover:bg-teal-100 hover:text-teal-800';
                button.addEventListener('click', () => {
                    state.selectedMonth = month;
                    renderDailyCards(month);
                    updateActiveMonthButton();
                    selectedLessonContent.innerHTML = `<p class="text-stone-500">Ø§Ø®ØªØ± ÙŠÙˆÙ…Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„.</p>`;
                    selectedLessonTitle.textContent = 'Ø§Ø®ØªØ± ÙŠÙˆÙ…Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ Ù„ØªØ¨Ø¯Ø£';
                    selectedLessonSubtitle.textContent = '';
                    geminiFeatures.classList.add('hidden');
                });
                monthButtonsContainer.appendChild(button);
            });
        }

        function renderDailyCards(month) {
            dailyCardsContainer.innerHTML = '';
            currentMonthTitle.textContent = month;
            const lessonsForMonth = yearlyPlanData.filter(lesson => lesson.month === month);

            lessonsForMonth.forEach(lesson => {
                const card = document.createElement('div');
                card.className = 'day-card bg-white p-4 rounded-xl shadow-md border border-stone-100 cursor-pointer transition-all duration-300 hover:shadow-lg hover:border-teal-300 hover:-translate-y-1';
                card.dataset.day = lesson.day;

                card.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold text-teal-600">Ø§Ù„ÙŠÙˆÙ… ${lesson.day}</span>
                        <span class="text-sm bg-teal-50 text-teal-700 px-2 py-1 rounded-full">${lesson.situation}</span>
                    </div>
                    <p class="text-stone-700 truncate">${lesson.english.split('B:')[0]}</p>
                `;

                card.addEventListener('click', () => {
                    state.selectedDay = lesson;
                    renderSelectedLesson();
                    updateActiveDayCard();
                    selectedLessonSection.scrollIntoView({ behavior: 'smooth' });
                });
                dailyCardsContainer.appendChild(card);
            });
        }
        
        function renderSelectedLesson() {
            if (!state.selectedDay) return;
            
            const lesson = state.selectedDay;
            selectedLessonTitle.textContent = `Ø§Ù„ÙŠÙˆÙ… ${lesson.day}: ${lesson.situation}`;
            selectedLessonSubtitle.textContent = lesson.month;
            
             const englishLinesHTML = lesson.english.split(/(?=A:|B:)/g).map(line => {
                if (line.trim()) {
                    const cleanLine = line.trim();
                    return `
                        <div class="flex items-center gap-3 text-left dir-ltr">
                            <button class="listen-sentence-btn flex-shrink-0 text-xl text-sky-600 hover:text-sky-800 transition" data-sentence="${cleanLine.replace(/"/g, '&quot;')}">
                                <span>ğŸ”Š</span>
                            </button>
                            <p class="text-lg text-stone-800">${cleanLine.replace(/A:/, '<strong>A:</strong>').replace(/B:/, '<strong>B:</strong>')}</p>
                        </div>
                    `;
                }
                return '';
            }).join('');

            selectedLessonContent.innerHTML = `
                <div class="space-y-4 md:px-4">
                    <div>
                        <h3 class="font-bold text-lg mb-2 text-stone-700">Ø§Ù„Ø­ÙˆØ§Ø± Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</h3>
                         <div class="bg-stone-100 p-4 rounded-lg space-y-2">
                            ${englishLinesHTML}
                        </div>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg mb-2 text-stone-700">Ø§Ù„Ø­ÙˆØ§Ø± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h3>
                        <p class="text-lg bg-stone-100 p-4 rounded-lg text-stone-800">${lesson.arabic.replace(/Ø£:/g, '<strong>Ø£:</strong>').replace(/Ø¨:/g, '<br><strong>Ø¨:</strong>')}</p>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg mb-2 text-stone-700">ÙƒÙ„Ù…Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
                        <div class="flex flex-wrap justify-center gap-2">
                            ${lesson.words.split(',').map(word => `<span class="bg-teal-100 text-teal-800 text-base font-medium px-3 py-1 rounded-full">${word.trim()}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
            geminiFeatures.classList.remove('hidden');
            geminiResponseContainer.innerHTML = `<p class="text-stone-500">Ø¬Ø±Ù‘Ø¨ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø£Ø¹Ù„Ø§Ù‡!</p>`;
        }
        
        async function handleGeminiButtonClick(apiCallFunction) {
            if (!state.selectedDay || state.isGeminiLoading) return;
            setGeminiLoading(true);
            try {
                await apiCallFunction();
            } catch (e) {
                geminiResponseContainer.innerHTML = `<p class="text-red-500">Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.</p>`;
            } finally {
                setGeminiLoading(false);
            }
        }

        expandDialogueBtn.addEventListener('click', () => handleGeminiButtonClick(async () => {
            const prompt = `You are an English teacher helping an Arabic-speaking family learn. Expand this short dialogue with 2 more natural lines for each speaker (A and B). Keep the language simple and suitable for beginners. Provide the expanded dialogue in English and then its Arabic translation. Format it clearly like this:
English Dialogue:
[expanded dialogue here]

Arabic Translation:
[translation here]
Original Dialogue:\n"${state.selectedDay.english}"`;
            const result = await callGeminiAPI(prompt);
             const englishDialogueMatch = result.match(/English Dialogue:([\s\S]*?)Arabic Translation:/);
            const englishTextForTTS = englishDialogueMatch ? englishDialogueMatch[1].trim().replace(/\n/g, ' ') : '';

            const formattedResult = result
                .replace(/English Dialogue:/g, `<div class="flex items-center gap-3 justify-end"><button class="listen-sentence-btn text-xl text-sky-600 hover:text-sky-800 transition" data-sentence="${englishTextForTTS.replace(/"/g, '&quot;')}"><span>ğŸ”Š</span></button><h4 class="font-bold text-teal-800 mb-2">Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„Ù…ÙˆØ³Ù‘Ø¹:</h4></div>`)
                .replace(/Arabic Translation:/g, '<h4 class="font-bold text-teal-800 mt-4 mb-2">Ø§Ù„ØªØ±Ø¬Ù…Ø©:</h4>')
                .replace(/\n/g, '<br>')
                .replace(/A:/g, '<strong>A:</strong>').replace(/B:/g, '<strong>B:</strong>')
                .replace(/Ø£:/g, '<strong>Ø£:</strong>').replace(/Ø¨:/g, '<strong>Ø¨:</strong>');
            geminiResponseContainer.innerHTML = `<div class="text-right text-lg p-2">${formattedResult}</div>`;
        }));

        newSituationBtn.addEventListener('click', () => handleGeminiButtonClick(async () => {
            const prompt = `You are an English teacher creating practice scenarios for an Arabic-speaking family. Using these keywords: "${state.selectedDay.words}", create a completely new, short, simple dialogue (2-3 lines for each speaker: A and B). Provide the dialogue in English and then its Arabic translation. Format it clearly like this:
English Dialogue:
[dialogue here]

Arabic Translation:
[translation here]`;
            const result = await callGeminiAPI(prompt);
            const englishDialogueMatch = result.match(/English Dialogue:([\s\S]*?)Arabic Translation:/);
            const englishTextForTTS = englishDialogueMatch ? englishDialogueMatch[1].trim().replace(/\n/g, ' ') : '';

            const formattedResult = result
                .replace(/English Dialogue:/g, `<div class="flex items-center gap-3 justify-end"><button class="listen-sentence-btn text-xl text-sky-600 hover:text-sky-800 transition" data-sentence="${englishTextForTTS.replace(/"/g, '&quot;')}"><span>ğŸ”Š</span></button><h4 class="font-bold text-teal-800 mb-2">Ø­ÙˆØ§Ø± Ø¬Ø¯ÙŠØ¯ Ù…Ù‚ØªØ±Ø­:</h4></div>`)
                .replace(/Arabic Translation:/g, '<h4 class="font-bold text-teal-800 mt-4 mb-2">Ø§Ù„ØªØ±Ø¬Ù…Ø©:</h4>')
                .replace(/\n/g, '<br>')
                .replace(/A:/g, '<strong>A:</strong>').replace(/B:/g, '<strong>B:</strong>')
                .replace(/Ø£:/g, '<strong>Ø£:</strong>').replace(/Ø¨:/g, '<strong>Ø¨:</strong>');
            geminiResponseContainer.innerHTML = `<div class="text-right text-lg p-2">${formattedResult}</div>`;
        }));
        
        selectedLessonSection.addEventListener('click', (e) => {
            const listenButton = e.target.closest('.listen-sentence-btn');
            if (listenButton && !state.isTTSLoading && !state.isGeminiLoading) {
                const textToSpeak = listenButton.dataset.sentence;
                const originalIcon = listenButton.innerHTML;
                listenButton.innerHTML = `<span>â³</span>`;
                listenButton.disabled = true;
                state.isTTSLoading = true;

                callGeminiTTSAPI(textToSpeak, () => {
                    listenButton.innerHTML = originalIcon;
                    listenButton.disabled = false;
                    state.isTTSLoading = false;
                });
            }
        });


        explainRuleBtn.addEventListener('click', () => handleGeminiButtonClick(async () => {
            const prompt = `As an English teacher for an Arabic-speaking family, simply explain in Arabic the main grammar rule in this English sentence: "${state.selectedDay.english}". Focus on one key concept. Keep it very simple and use bullet points if helpful.`;
            const result = await callGeminiAPI(prompt);
            geminiResponseContainer.innerHTML = `<div class="text-right text-lg p-2 whitespace-pre-wrap">${result}</div>`;
        }));
        
        visualizeSituationBtn.addEventListener('click', () => handleGeminiButtonClick(async () => {
            const prompt = `A cheerful, simple, and bright cartoon illustration for a family learning English. The scene should depict: "${state.selectedDay.situation}". Include elements related to these keywords: ${state.selectedDay.words}. The style should be friendly and educational for kids.`;
            const imageUrl = await callImagenAPI(prompt);
            if(imageUrl) {
                geminiResponseContainer.innerHTML = `<img src="${imageUrl}" alt="ØµÙˆØ±Ø© ØªÙ… ØªÙˆÙ„ÙŠØ¯Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ" class="rounded-lg shadow-md mx-auto max-w-full h-auto" />`;
            } else {
                geminiResponseContainer.innerHTML = `<p class="text-red-500">Ù„Ù… ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>`;
            }
        }));
        
        rolePlayBtn.addEventListener('click', () => {
            if (!state.selectedDay) return;
            const firstLine = state.selectedDay.english.split('B:')[0].trim();
            const secondLine = "B:" + state.selectedDay.english.split('B:')[1].trim();

            geminiResponseContainer.innerHTML = `
                <div class="text-right w-full space-y-3">
                    <h4 class="font-bold text-teal-800">Ù„Ø¹Ø¨ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ğŸ­</h4>
                     <div class="flex items-center gap-3 bg-stone-100 p-3 rounded-lg">
                        <button class="listen-sentence-btn text-xl text-sky-600 hover:text-sky-800 transition" data-sentence="${firstLine.replace(/"/g, '&quot;')}"><span>ğŸ”Š</span></button>
                        <p class="text-stone-600 text-left dir-ltr">${firstLine}</p>
                    </div>
                    <p class="text-stone-700">Ø§Ù„Ø¢Ù† Ø¯ÙˆØ±Ùƒ. Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ ÙƒÙ€ (B):</p>
                    <textarea id="role-play-input" class="w-full p-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-rose-400"></textarea>
                    <button id="check-role-play-btn" class="gemini-btn bg-rose-500 text-white font-semibold py-2 px-5 rounded-full hover:bg-rose-600 transition">ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø¯ÙŠ</button>
                    <div id="role-play-feedback" class="mt-2"></div>
                </div>
            `;

            document.getElementById('check-role-play-btn').addEventListener('click', () => {
                 const userInput = document.getElementById('role-play-input').value;
                 const feedbackContainer = document.getElementById('role-play-feedback');
                 if (!userInput) {
                     feedbackContainer.innerHTML = `<p class="text-amber-600">Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø±Ø¯ Ø£ÙˆÙ„Ø§Ù‹.</p>`;
                     return;
                 }
                 
                 handleGeminiButtonClick(async () => {
                    feedbackContainer.innerHTML = '<div class="loader mx-auto"></div>';
                    const prompt = `You are a friendly English teacher. A student is practicing a dialogue. The correct line for Speaker B is: "${secondLine}". The student wrote: "${userInput}". Is the student's response correct or close enough? Provide a very simple correction and encouragement in Arabic. Keep the feedback short.`;
                    const result = await callGeminiAPI(prompt);
                    feedbackContainer.innerHTML = `<div class="p-2 text-rose-800 bg-rose-50 rounded-lg mt-2">${result}</div>`;
                 });
            });
        });

        quizBtn.addEventListener('click', () => handleGeminiButtonClick(async () => {
            const prompt = `You are an English teacher creating a simple quiz for an Arabic-speaking family. Based on these keywords: "${state.selectedDay.words}", create ONE simple multiple-choice question to test one of the words. The question and options should be in English. Provide the correct answer separately. Format it as a valid JSON object only: {"question": "...", "options": ["...", "...", "..."], "answer": "..."}`;
            const result = await callGeminiAPI(prompt);
            
            try {
                // Find and extract the JSON part of the string to make parsing more robust
                const jsonMatch = result.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error("No valid JSON found in the API response.");
                }
                const jsonString = jsonMatch[0];
                const quizData = JSON.parse(jsonString);

                let optionsHTML = '';
                quizData.options.forEach(option => {
                    optionsHTML += `<button class="quiz-option-btn w-full bg-lime-100 text-lime-800 p-3 rounded-lg hover:bg-lime-200 transition" data-option="${option}">${option}</button>`;
                });

                geminiResponseContainer.innerHTML = `
                    <div class="text-right w-full space-y-3">
                         <div class="flex items-center gap-3 justify-end">
                            <button class="listen-sentence-btn text-xl text-sky-600 hover:text-sky-800 transition" data-sentence="${quizData.question.replace(/"/g, '&quot;')}"><span>ğŸ”Š</span></button>
                            <h4 class="font-bold text-teal-800">Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ ğŸ§ </h4>
                         </div>
                         <p class="text-stone-700 text-lg text-left dir-ltr">${quizData.question}</p>
                         <div class="space-y-2">${optionsHTML}</div>
                         <div id="quiz-feedback" class="mt-2 h-6"></div>
                    </div>
                `;

                document.querySelectorAll('.quiz-option-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const selectedOption = btn.dataset.option;
                        const feedbackContainer = document.getElementById('quiz-feedback');
                        document.querySelectorAll('.quiz-option-btn').forEach(b => b.disabled = true);
                        if(selectedOption.toLowerCase() === quizData.answer.toLowerCase()) {
                            btn.classList.remove('bg-lime-100');
                            btn.classList.add('bg-green-500', 'text-white');
                            feedbackContainer.innerHTML = `<p class="text-green-600 font-bold">Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!</p>`;
                        } else {
                            btn.classList.remove('bg-lime-100');
                            btn.classList.add('bg-red-500', 'text-white');
                            feedbackContainer.innerHTML = `<p class="text-red-600 font-bold">Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: ${quizData.answer}</p>`;
                        }
                    });
                });

            } catch(e) {
                geminiResponseContainer.innerHTML = `<p class="text-red-500">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>`;
            }
        }));

        storyBtn.addEventListener('click', () => handleGeminiButtonClick(async () => {
            const prompt = `You are an English teacher. Write a very short and simple story (2-3 sentences) for a beginner English learner, using these keywords: "${state.selectedDay.words}". Provide the story in English and then its Arabic translation. Format it clearly like this:
English Story:
[story here]

Arabic Translation:
[translation here]`;
            const result = await callGeminiAPI(prompt);
            const englishStoryMatch = result.match(/English Story:([\s\S]*?)Arabic Translation:/);
            const englishTextForTTS = englishStoryMatch ? englishStoryMatch[1].trim().replace(/\n/g, ' ') : '';

            const formattedResult = result
                .replace(/English Story:/g, `<div class="flex items-center gap-3 justify-end"><button class="listen-sentence-btn text-xl text-sky-600 hover:text-sky-800 transition" data-sentence="${englishTextForTTS.replace(/"/g, '&quot;')}"><span>ğŸ”Š</span></button><h4 class="font-bold text-teal-800 mb-2">Ù‚ØµØ© Ø§Ù„ÙŠÙˆÙ…:</h4></div>`)
                .replace(/Arabic Translation:/g, '<h4 class="font-bold text-teal-800 mt-4 mb-2">Ø§Ù„ØªØ±Ø¬Ù…Ø©:</h4>')
                .replace(/\n/g, '<br>');
            geminiResponseContainer.innerHTML = `<div class="text-right text-lg p-2">${formattedResult}</div>`;
        }));

        cultureBtn.addEventListener('click', () => handleGeminiButtonClick(async () => {
            const prompt = `Based on the daily situation of '${state.selectedDay.situation}', provide a very short, simple, and interesting cultural tip in Arabic for a family learning English. Keep it concise.`;
            const result = await callGeminiAPI(prompt);
            geminiResponseContainer.innerHTML = `<div class="text-right text-lg p-2"><h4 class="font-bold text-teal-800 mb-2">ğŸ’¡ Ù…Ø¹Ù„ÙˆÙ…Ø© Ø«Ù‚Ø§ÙÙŠØ©:</h4><p>${result}</p></div>`;
        }));

        correctSentenceBtn.addEventListener('click', () => {
            const sentence = sentenceInput.value.trim();
            if (!sentence) {
                geminiResponseContainer.innerHTML = `<p class="text-amber-600">Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø¬Ù…Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹.</p>`;
                return;
            }
            handleGeminiButtonClick(async () => {
                const prompt = `You are an English teacher for an Arabic-speaking family. Correct the following sentence written by a beginner. Provide the corrected sentence and a very simple, one-line explanation in Arabic about the correction.\n- Sentence to correct: "${sentence}"\n- The learner was trying to use these keywords: "${state.selectedDay.words}"\n- Format your response clearly in two parts: "Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:" and "Ø§Ù„Ø´Ø±Ø­:".`;
                const result = await callGeminiAPI(prompt);
                const formattedResult = result
                    .replace(/Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:/g, '<h4 class="font-bold text-teal-800 mb-2">Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</h4>')
                    .replace(/Ø§Ù„Ø´Ø±Ø­:/g, '<h4 class="font-bold text-teal-800 mt-4 mb-2">Ø§Ù„Ø´Ø±Ø­:</h4>')
                    .replace(/\n/g, '<br>');
                geminiResponseContainer.innerHTML = `<div class="text-right text-lg p-2">${formattedResult}</div>`;
            });
        });

        function updateActiveMonthButton() {
            document.querySelectorAll('.month-btn').forEach(btn => {
                if (btn.dataset.month === state.selectedMonth) {
                    btn.classList.add('bg-teal-600', 'text-white');
                    btn.classList.remove('text-stone-600');
                } else {
                    btn.classList.remove('bg-teal-600', 'text-white');
                    btn.classList.add('text-stone-600');
                }
            });
        }
        
        function updateActiveDayCard() {
             document.querySelectorAll('.day-card').forEach(card => {
                if (card.dataset.day === state.selectedDay.day) {
                    card.classList.add('border-teal-400', 'ring-2', 'ring-teal-300');
                    card.classList.remove('border-stone-100');
                } else {
                    card.classList.remove('border-teal-400', 'ring-2', 'ring-teal-300');
                    card.classList.add('border-stone-100');
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const uniqueMonths = [...new Set(yearlyPlanData.map(item => item.month))];
            state.selectedMonth = uniqueMonths[0];
            
            renderMonthButtons(uniqueMonths);
            renderDailyCards(state.selectedMonth);
            updateActiveMonthButton();
        });

    </script>
</body>
</html>

